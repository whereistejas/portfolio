---
import "../styles/readinglist.css";

import Homepage from "../components/homepage.astro";
import Textorlink from "../components/textorlink.astro";

import { Omnivore } from "@omnivore-app/api";
import Row from "../components/row.astro";

const OMNIVORE_API_URL = "https://api-prod.omnivore.app/api/graphql";
const OMNIVORE_API_KEY = "2b6ef701-27a9-4fe6-9ec2-994d0b6f2e8a"; // Replace with your actual API key
const omnivore = new Omnivore({
  apiKey: OMNIVORE_API_KEY,
  baseUrl: OMNIVORE_API_URL,
});

const data = await omnivore.items.search({
  after: 0,
  first: 1000,
  query: "in:archive",
});
const articles = data.edges.map((edge) => edge.node);

const headers = [
  { type: "text", content: "TEJAS SANAP" },
  { type: "text", content: "READING LIST" },
  { type: "link", content: "CLOSE", href: "/" },
];
---

<Homepage>
  <Fragment slot="header">
    {
      headers.map((el) => (
        <Textorlink type={el.type} content={el.content} href={el.href} />
      ))
    }
  </Fragment>
  <Fragment slot="main">
    <section class="readinglist">
      <div class="readinglist-inner">
        {
          articles.map((article) => (
            <div class="row">
              <div>{new Date(article.savedAt).toLocaleDateString()}</div>
              <div class="value">
                <p>
                  <a
                    href={article.url}
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {article.title}
                  </a>
                </p>
              </div>
            </div>
          ))
        }
      </div>
    </section>
  </Fragment>
</Homepage>
